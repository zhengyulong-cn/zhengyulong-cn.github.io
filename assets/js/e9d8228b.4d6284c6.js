"use strict";(self.webpackChunkprivate_long_blog=self.webpackChunkprivate_long_blog||[]).push([[7924],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>k});var r=n(7294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n,r,s={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var c=r.createContext({}),i=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=i(e.components);return r.createElement(c.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,s=e.mdxType,o=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=i(n),m=s,k=u["".concat(c,".").concat(m)]||u[m]||d[m]||o;return n?r.createElement(k,a(a({ref:t},p),{},{components:n})):r.createElement(k,a({ref:t},p))}));function k(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var o=n.length,a=new Array(o);a[0]=m;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l[u]="string"==typeof e?e:s,a[1]=l;for(var i=2;i<o;i++)a[i]=n[i];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2891:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>i});var r=n(7462),s=(n(7294),n(3905));const o={},a="React\u751f\u6001\u2014\u2014Redux",l={unversionedId:"programing-skills/React\u4ece\u5165\u95e8\u5230\u7cbe\u901a/React\u751f\u6001\u2014\u2014Redux",id:"programing-skills/React\u4ece\u5165\u95e8\u5230\u7cbe\u901a/React\u751f\u6001\u2014\u2014Redux",title:"React\u751f\u6001\u2014\u2014Redux",description:"Redux\u57fa\u672c\u6982\u5ff5",source:"@site/docs/programing-skills/React\u4ece\u5165\u95e8\u5230\u7cbe\u901a/React\u751f\u6001\u2014\u2014Redux.md",sourceDirName:"programing-skills/React\u4ece\u5165\u95e8\u5230\u7cbe\u901a",slug:"/programing-skills/React\u4ece\u5165\u95e8\u5230\u7cbe\u901a/React\u751f\u6001\u2014\u2014Redux",permalink:"/docs/programing-skills/React\u4ece\u5165\u95e8\u5230\u7cbe\u901a/React\u751f\u6001\u2014\u2014Redux",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"programing-skills",previous:{title:"React\u5165\u95e8\u2014\u2014\u4e0eTypeScript\u8054\u7528",permalink:"/docs/programing-skills/React\u4ece\u5165\u95e8\u5230\u7cbe\u901a/React\u5165\u95e8\u2014\u2014\u4e0eTypeScript\u8054\u7528"},next:{title:"React\u751f\u6001\u2014\u2014React router",permalink:"/docs/programing-skills/React\u4ece\u5165\u95e8\u5230\u7cbe\u901a/React\u751f\u6001\u2014\u2014React-router"}},c={},i=[{value:"Redux\u57fa\u672c\u6982\u5ff5",id:"redux\u57fa\u672c\u6982\u5ff5",level:2},{value:"\u5e94\u7528\u7ed3\u6784\u548c\u6570\u636e\u6d41",id:"\u5e94\u7528\u7ed3\u6784\u548c\u6570\u636e\u6d41",level:2},{value:"\u5f02\u6b65\u903b\u8f91",id:"\u5f02\u6b65\u903b\u8f91",level:2},{value:"\u6027\u80fd\u4e0e\u8303\u5f0f\u4f18\u5316",id:"\u6027\u80fd\u4e0e\u8303\u5f0f\u4f18\u5316",level:2},{value:"\u8bb0\u5fc6\u5316selector\u51fd\u6570",id:"\u8bb0\u5fc6\u5316selector\u51fd\u6570",level:3},{value:"\u8303\u5f0f\u5316\u6570\u636e",id:"\u8303\u5f0f\u5316\u6570\u636e",level:3},{value:"RTK Query",id:"rtk-query",level:2}],p={toc:i},u="wrapper";function d(e){let{components:t,...o}=e;return(0,s.kt)(u,(0,r.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"react\u751f\u6001redux"},"React\u751f\u6001\u2014\u2014Redux"),(0,s.kt)("h2",{id:"redux\u57fa\u672c\u6982\u5ff5"},"Redux\u57fa\u672c\u6982\u5ff5"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Redux\u662f\u4e00\u4e2a\u4f7f\u7528\u53eb\u505a\u201caction\u201d\u7684\u4e8b\u4ef6\u6765\u7ba1\u7406\u548c\u66f4\u65b0\u5e94\u7528\u72b6\u6001\u7684\u6a21\u5f0f\u548c\u5de5\u5177\u5e93"),"\u3002\u5b83\u4ee5\u96c6\u4e2d\u5f0fStore\u7684\u65b9\u5f0f\u5bf9\u6574\u4e2a\u5e94\u7528\u4e2d\u4f7f\u7528\u7684\u72b6\u6001\u8fdb\u884c\u96c6\u4e2d\u7ba1\u7406\uff0c\u5176\u89c4\u5219\u786e\u4fdd\u72b6\u6001\u53ea\u80fd\u4ee5\u53ef\u9884\u6d4b\u7684\u65b9\u5f0f\u66f4\u65b0\u3002"),(0,s.kt)("p",null,"Redux\u80fd\u5e2e\u4f60\u7ba1\u7406\u5168\u5c40\u72b6\u6001\uff0c\u5e94\u7528\u7a0b\u5e8f\u4e2d\u5f88\u591a\u7ec4\u4ef6\u90fd\u9700\u8981\u3002"),(0,s.kt)("p",null,"Redux\u662f\u4e00\u4e2a\u5c0f\u578b\u72ec\u7acb\u7684JS\u5e93\uff0c\u4f46\u5e38\u5e38\u548c\u5176\u4ed6\u5305\u4e00\u8d77\u4f7f\u7528\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"React-Redux\uff1a\u7528\u4e8e\u548cReact\u96c6\u6210\uff0c\u8ba9React\u7ec4\u4ef6\u80fd\u8bbf\u95ee\u5230state\u7247\u6bb5\u548cdispatch actions\u66f4\u65b0store\u3002"),(0,s.kt)("li",{parentName:"ul"},"Redux Toolkit\uff1a\u63a8\u8350\u7f16\u5199Redux\u903b\u8f91\u7684\u65b9\u6cd5\uff0c\u7b80\u5316Redux\u539f\u59cb\u5199\u6cd5\uff0c\u9884\u9632\u5e38\u89c1\u9519\u8bef\u3002"),(0,s.kt)("li",{parentName:"ul"},"Redux DevTools\u6269\u5c55\uff1a\u5728\u63a7\u5236\u53f0\u663e\u793aRedux\u5b58\u50a8\u72b6\u6001\u3002")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"npm install @reduxjs/toolkit\n# \u5728react18\u4e2d\uff0c\u5b89\u88c5redux-devtools\u9700\u8981\u6dfb\u52a0--legacy-peer-deps\u53c2\u6570\nnpm install --save-dev redux-devtools --legacy-peer-deps\nnpm install react-redux --legacy-peer-deps\n")),(0,s.kt)("p",null,"\u4e0d\u53ef\u53d8immutable\uff1a\u5728\u524d\u9762\u7684React\u7ae0\u8282\u5df2\u63d0\u53ca\u5230\u4e86\uff0c\u5fc5\u987b\u5148\u590d\u5236\u539f\u5148\u5bf9\u8c61\u6216\u6570\u7ec4\uff0c\u7136\u540e\u66f4\u65b0\u590d\u5236\u4f53\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"// mutable\nconst arr = ['a', 'b']\narr.push('c')\narr[1] = 'd'\n\n// immutable\nconst arr = ['a', 'b']\nconst arr2 = arr.concat('c')\nconst arr3 = arr.slice()\n")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Redux\u671f\u671b\u6240\u6709\u72b6\u6001\u66f4\u65b0\u90fd\u662f\u4f7f\u7528\u4e0d\u53ef\u53d8\u7684\u65b9\u5f0f"),"\u3002"),(0,s.kt)("p",null,"\u5e94\u7528\u7ec4\u6210\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"View\uff1a\u57fa\u4e8e\u5f53\u524d\u72b6\u6001\u7684\u89c6\u56fe\u58f0\u660e\u6027\u63cf\u8ff0\u3002"),(0,s.kt)("li",{parentName:"ul"},"Store",(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"Reducer\uff1a\u63a5\u6536\u5f53\u524dstate\u548caction\u5bf9\u8c61\uff0c\u8fd4\u56de\u65b0\u72b6\u6001\u3002",(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"\u53ea\u80fd\u4f7f\u7528state\u548cactions\u53c2\u6570\u8ba1\u7b97\u65b0\u72b6\u6001\u503c\u3002"),(0,s.kt)("li",{parentName:"ul"},"\u7981\u6b62\u76f4\u63a5\u4fee\u6539state\uff0c\u8981\u6c42\u505a\u4e0d\u53ef\u53d8\u66f4\u65b0\u3002"),(0,s.kt)("li",{parentName:"ul"},"\u7981\u6b62\u4efb\u4f55\u5f02\u6b65\u903b\u8f91\u3001\u4f9d\u8d56\u968f\u673a\u503c\u6216\u5bfc\u81f4\u5176\u4ed6\u526f\u4f5c\u7528\u4ee3\u7801\u3002"))),(0,s.kt)("li",{parentName:"ul"},"State\uff1a\u6570\u636e\u6e90\u5934\u3002"))),(0,s.kt)("li",{parentName:"ul"},"Actions\uff1a\u5177\u6709type\u5b57\u6bb5\u7684JavaScript\u5bf9\u8c61\uff0c\u6839\u636e\u7528\u6237\u8f93\u5165\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u53d1\u751f\u7684\u4e8b\u4ef6\u6765\u89e6\u53d1\u66f4\u65b0\u3002",(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"Action Creator\uff1a\u521b\u5efa\u5e76\u8fd4\u56deAction\u5bf9\u8c61\u7684\u51fd\u6570\uff0c\u4f5c\u7528\u662f\u8ba9\u4f60\u4e0d\u5fc5\u6bcf\u6b21\u90fd\u624b\u52a8\u7f16\u5199Action\u5bf9\u8c61\u3002"))),(0,s.kt)("li",{parentName:"ul"},"Dispatch\uff1a\u901a\u8fc7\u8c03\u7528",(0,s.kt)("inlineCode",{parentName:"li"},"store.dispatch(action)"),"\u66f4\u65b0state\uff0c\u7136\u540e\u8c03\u7528",(0,s.kt)("inlineCode",{parentName:"li"},"getState()"),"\u83b7\u53d6\u65b0state\u3002\u5b83\u7684\u4f5c\u7528\u7c7b\u4f3c\u4e8e\u4e8b\u4ef6\u89e6\u53d1\u3002"),(0,s.kt)("li",{parentName:"ul"},"Selector\uff1a\u53ef\u4ee5\u4ecestore\u72b6\u6001\u6811\u4e2d\u63d0\u53d6\u6307\u5b9a\u7247\u6bb5\uff0cSelector\u53ef\u4ee5\u907f\u514d\u91cd\u590d\u7684\u8bfb\u53d6\u903b\u8f91\u3002")),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"Redux\u6570\u636e\u6d41",src:n(7120).Z,width:"1440",height:"1080"})),(0,s.kt)("h2",{id:"\u5e94\u7528\u7ed3\u6784\u548c\u6570\u636e\u6d41"},"\u5e94\u7528\u7ed3\u6784\u548c\u6570\u636e\u6d41"),(0,s.kt)("p",null,"\u4e3b\u8981\u5206\u4e3a\u56db\u5757\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"App\u6839\u7ec4\u4ef6Provier\u6574\u4e2astore\uff08\u53ea\u6709\u4e00\u4e2a\uff09"),(0,s.kt)("li",{parentName:"ul"},"store\u914d\u7f6e\u6587\u4ef6\uff08\u53ea\u6709\u4e00\u4e2a\uff09"),(0,s.kt)("li",{parentName:"ul"},"\u4e00\u7cfb\u5217reducer\u6587\u4ef6"),(0,s.kt)("li",{parentName:"ul"},"UI\u5c42\u8c03\u7528\u6587\u4ef6")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"src\n\u2502  App.tsx\n\u2502  main.tsx\n\u2502  vite-env.d.ts\n\u251c\u2500components\n\u2502  \u2514\u2500Counter\n\u2502          index.module.css\n\u2502          index.tsx\n\u2514\u2500store\n    \u2502  index.ts\n    \u2514\u2500reducer\n            counterSlice.ts\n")),(0,s.kt)("p",null,"App\u6839\u7ec4\u4ef6\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx{1,2,6,8}"},'import store from "./store";\nimport { Provider } from \'react-redux\'\nimport { Counter } from "./components/Counter";\n// \u5728\u9876\u90e8\u901a\u8fc7Provider\u63d0\u4f9b\u6574\u4e2astore\nexport default function App() {\n  return <Provider store={store}>\n    <Counter />\n  </Provider>\n}\n')),(0,s.kt)("p",null,"store\u914d\u7f6e\u6587\u4ef6\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx"},"import { configureStore } from '@reduxjs/toolkit'\nimport counterReducer from './reducer/counterSlice'\n\n// \u914d\u7f6estore\nconst store = configureStore({\n  reducer: {\n    counter: counterReducer,\n  }\n})\n\n// \u76f8\u5173TS\u5b9a\u4e49\uff0c\u53ef\u6709\u53ef\u65e0\nexport type AppDispatch = typeof store.dispatch\nexport type RootState = ReturnType<typeof store.getState>\n\nexport default store\n")),(0,s.kt)("p",null,"reducer\u6587\u4ef6\u4f8b\u5b50\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx"},"import { createSlice, PayloadAction } from '@reduxjs/toolkit'\nimport type { Dispatch } from '@reduxjs/toolkit'\nimport { RootState } from '../index'\n\ninterface ICounterState {\n  count: number\n}\nconst initialState: ICounterState = {\n  count: 0\n}\n// \u521b\u5efaSlice\uff0cSlice\u662f\u5e94\u7528\u4e2d\u5e72\u6208\u529f\u80fd\u7684Redux reducer\u903b\u8f91\u548caction\u7684\u96c6\u5408\nexport const counterSlice = createSlice({\n  name: 'counter',\n  initialState,\n  /**\n   * \u751f\u6210\u4e09\u79cd\u4e0d\u540c\u7c7b\u578b\u7684Redux action\uff1a\n   * {type: \"counter/increment\"}\n   * {type: \"counter/decrement\"}\n   * {type: \"counter/incrementByAmount\"}\n   */\n  reducers: {\n    increment: (state) => {\n      state.count += 1\n    },\n    decrement: (state) => {\n      state.count -= 1\n    },\n    incrementByAmount: (state, action: PayloadAction<number>) => {\n      state.count += action.payload\n    },\n  },\n})\n\n/**\n * \u8fd9\u662f\u4e2athunk\u51fd\u6570\uff0c\u53ef\u4ee5\u6267\u884c\u5f02\u6b65\u903b\u8f91\u3002\n * \u8c03\u7528thunk\u65f6\u63a5\u53d7dispatch\u51fd\u6570\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u5f02\u6b65\u4ee3\u7801\u6267\u884c\u5b8c\u6bd5\uff0c\u53ef\u4ee5dispatch actions\n */\nexport const incrementAsync = (amount: number) => {\n  return (dispatch: Dispatch) => {\n    setTimeout(() => {\n      dispatch(incrementByAmount(amount))\n    }, 1000)\n  }\n}\n\nexport const selectCount = (state: RootState) => state.counter.count\n\nexport const { increment, decrement, incrementByAmount } = counterSlice.actions\n\nexport default counterSlice.reducer\n")),(0,s.kt)("p",null,"UI\u5c42\u8c03\u7528\u6587\u4ef6\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-jsx{2-9,13-17}"},'import React, { useState } from "react";\nimport { useSelector, useDispatch } from "react-redux";\nimport {\n  decrement,\n  increment,\n  incrementByAmount,\n  incrementAsync,\n  selectCount\n} from "../../store/reducer/counterSlice";\nimport styles from "./index.module.css";\n\nexport function Counter() {\n  // useSelector\u80fd\u8ba9\u6211\u4eec\u4eceRedux\u7684store\u72b6\u6001\u6811\u79cd\u63d0\u53d6\u9700\u8981\u7684\u4efb\u4f55\u6570\u636e\n  const count = useSelector(selectCount);\n  // useDispatch\u80fd\u8ba9\u6211\u4eec\u4eceRedux\u79cd\u8bbf\u95eeaction\n  const dispatch = useDispatch();\n  const [incrementAmount, setIncrementAmount] = useState<number>(0);\n\n  return (\n    <div>\n      <div className={styles.row}>\n        <button\n          className={styles.button}\n          aria-label="Increment value"\n          onClick={() => dispatch(increment())}\n        >\n          +\n        </button>\n        <span className={styles.value}>{count}</span>\n        <button\n          className={styles.button}\n          aria-label="Decrement value"\n          onClick={() => dispatch(decrement())}\n        >\n          -\n        </button>\n      </div>\n      <div className={styles.row}>\n        <input\n          className={styles.textbox}\n          aria-label="Set increment amount"\n          value={incrementAmount}\n          onChange={(e: React.ChangeEvent<HTMLInputElement>) => setIncrementAmount(Number(e.target.value))}\n        />\n        <button\n          className={styles.button}\n          onClick={() =>\n            dispatch(incrementByAmount(Number(incrementAmount) || 0))\n          }\n        >\n          Add Amount\n        </button>\n        <button\n          className={styles.asyncButton}\n          onClick={() => dispatch(incrementAsync(incrementAmount))}\n        >\n          Add Async\n        </button>\n      </div>\n    </div>\n  );\n}\n')),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"redux\u8ba1\u6570\u5668",src:n(1805).Z,width:"596",height:"176"})),(0,s.kt)("p",null,"\u6570\u636e\u6d41\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Redux State\u7531reducer\u51fd\u6570\u6765\u66f4\u65b0"),(0,s.kt)("li",{parentName:"ul"},"React\u7ec4\u4ef6\u4f7f\u7528useSelector\u94a9\u5b50\u4ecestore\u8bfb\u53d6\u6570\u636e"),(0,s.kt)("li",{parentName:"ul"},"React\u7ec4\u4ef6\u4f7f\u7528useDispatch\u94a9\u5b50dispatch action\u6765\u66f4\u65b0store")),(0,s.kt)("p",null,"\u4efb\u610fReact\u7ec4\u4ef6\u90fd\u80fd\u4eceRedux store\u79cd\u62ff\u5230\u5176\u4ed6\u9700\u8981\u7684\u6570\u636e\uff0c\u90fd\u80fd\u901a\u8fc7dispatch action\u5f15\u53d1\u72b6\u6001\u66f4\u65b0\u3002"),(0,s.kt)("p",null,"reducers\u4e2d\u7684\u51fd\u6570\u5176\u5b9e\u8fd8\u6709\u79cd\u5bf9\u8c61\u5199\u6cd5\uff0c\u5f53\u9700\u8981\u8bbe\u7f6e\u521d\u59cb\u503c\u65f6\u53ef\u4ee5\u7528\u5230\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"const postsSlice = createSlice({\n  name: 'posts',\n  initialState,\n  reducers: {\n    postAdded: {\n      // \u4f20\u5165\u7684\u503c\u5148\u5728prepare\u51fd\u6570\u4e2d\u7ecf\u8fc7\u5904\u7406\uff0c\u7136\u540e\u518d\u5305\u88c5\u6210payload\u4f20\u7ed9reducer\u51fd\u6570\n      reducer(state, action) {\n        state.push(action.payload)\n      },\n      prepare(title, content) {\n        return {\n          payload: {\n            id: nanoid(),\n            title,\n            content\n          }\n        }\n      }\n    }\n    // other reducers here\n  }\n})\n")),(0,s.kt)("h2",{id:"\u5f02\u6b65\u903b\u8f91"},"\u5f02\u6b65\u903b\u8f91"),(0,s.kt)("p",null,"Redux middleware\u6269\u5c55\u4e86store\uff0c\u5141\u8bb8\u8ba9\u4e0d\u540c\u7c7b\u578b\u7684\u5f02\u6b65\u903b\u8f91\u4e0estore\u4ea4\u4e92\uff0c\u540c\u65f6\u5c06\u903b\u8f91\u548cUI\u5206\u9694\u5f00\u3002"),(0,s.kt)("p",null,"Redux\u6709\u591a\u79cd\u5f02\u6b65middleware\uff0c\u6bcf\u79cd\u90fd\u5141\u8bb8\u4f7f\u7528\u4e0d\u540c\u8bed\u6cd5\u7f16\u5199\u903b\u8f91\uff0c\u6700\u5e38\u89c1\u7684\u5f02\u6b65middleware\u662fredux-thunk\uff0c\u5b83\u53ef\u4ee5\u8ba9\u4f60\u7f16\u5199\u53ef\u80fd\u76f4\u63a5\u5305\u542b\u5f02\u6b65\u903b\u8f91\u7684\u666e\u901a\u51fd\u6570\u3002Redux Toolkit\u7684",(0,s.kt)("inlineCode",{parentName:"p"},"configureStore"),"\u529f\u80fd\u9ed8\u8ba4\u81ea\u52a8\u8bbe\u7f6ethunk middleware\uff0c\u662f\u5b98\u65b9\u63a8\u8350\u65b9\u5f0f\u3002"),(0,s.kt)("p",null,"\u5f53\u5f15\u5165\u5f02\u6b65\u903b\u8f91\u65f6\uff0c\u6dfb\u52a0\u4e00\u4e2a\u989d\u5916\u6b65\u9aa4\uff0cmiddleware\u53ef\u4ee5\u50cf\u5141\u8bb8AJAX\u8bf7\u6c42\u8fd9\u6837\u7684\u903b\u8f91\uff0c\u7136\u540edispatch action\uff1a"),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"ReduxAsyncDataFlowDiagram",src:n(1501).Z,width:"1440",height:"1080"})),(0,s.kt)("p",null,"\u4e0a\u9762\u4f8b\u5b50\u4e2d\u6709\u4e00\u4e2a\u539f\u751f\u7684thunk\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"export const incrementAsync = amount => dispatch => {\n  setTimeout(() => {\n    dispatch(incrementByAmount(amount))\n  }, 1000)\n}\n")),(0,s.kt)("p",null,"Redux\u6570\u636e\u8bf7\u6c42\u903b\u8f91\u901a\u5e38\u9075\u5faa\u4ee5\u4e0b\u53ef\u9884\u6d4b\u6a21\u5f0f\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"dispatch action\uff0c\u4ee5\u6307\u793a\u8bf7\u6c42\u6b63\u5728\u8fdb\u884c\u4e2d\uff0c\u53ef\u7528\u4e8e\u8ffd\u8e2a\u52a0\u8f7d\u72b6\u6001\u4ee5\u5141\u8bb8\u8df3\u8fc7\u91cd\u590d\u8bf7\u6c42\u6216\u5728UI\u4e2d\u663e\u793a\u52a0\u8f7d\u4e2d\u63d0\u793a\u3002"),(0,s.kt)("li",{parentName:"ul"},"\u53d1\u51fa\u5f02\u6b65\u8bf7\u6c42\u3002"),(0,s.kt)("li",{parentName:"ul"},"\u6839\u636e\u8bf7\u6c42\u7ed3\u679c\uff0c\u5f02\u6b65\u903b\u8f91dispatch\u5305\u542b\u7ed3\u679c\u6570\u636e\u7684\u6210\u529faction\u6216\u5305\u542b\u9519\u8bef\u7684\u5931\u8d25action\u3002\u8fd9\u4e24\u79cd\u60c5\u51b5\u4e0b\uff0creducer\u903b\u8f91\u4f1a\u6e05\u9664\u52a0\u8f7d\u72b6\u6001\uff0c\u5e76\u5c55\u793a\u7ed3\u679c\u6570\u636e\uff0c\u8981\u4e48\u4fdd\u5b58\u9519\u8bef\u4e2d\u5728\u9700\u6c42\u5730\u65b9\u5c55\u793a\u3002")),(0,s.kt)("p",null,"Redux Toolkit\u63d0\u4f9b\u4e00\u4e2a",(0,s.kt)("inlineCode",{parentName:"p"},"createAsyncThunk"),"API\u6765\u5b9e\u73b0\u8fd9\u4e9baction\u7684\u521b\u5efa\u548cdispatch\u3002"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"createAsyncThunk"),"\u63a5\u65362\u4e2a\u53c2\u6570\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"\u5c06\u7528\u4f5c\u751f\u6210\u7684action\u7c7b\u578b\u7684\u524d\u7f00\u5b57\u7b26\u4e32"),(0,s.kt)("li",{parentName:"ul"},"payload creator\u56de\u8c03\u51fd\u6570\uff0c\u8fd4\u56dePromise")),(0,s.kt)("p",null,"\u5f53\u8c03\u7528",(0,s.kt)("inlineCode",{parentName:"p"},"dispatch(fetchPosts())"),"\u7684\u65f6\u5019\uff0c",(0,s.kt)("inlineCode",{parentName:"p"},"fetchPosts"),"\u8fd9\u4e2athunk\u4f1a\u9996\u5148dispatch\u4e00\u4e2aaction\u7c7b\u578b\u4e3a",(0,s.kt)("inlineCode",{parentName:"p"},"'posts/fetchPosts/pending'"),"\uff0c\u53ef\u4ee5\u5728reducer\u4e2d\u76d1\u542c\u5230\u8fd9\u4e2aaction\u3002\u4e00\u65e6Promise\u6210\u529f\uff0c",(0,s.kt)("inlineCode",{parentName:"p"},"fetchPosts"),"thunk\u4f1a\u63a5\u53d7\u6211\u4eec\u4ece\u56de\u8c03\u4e2d\u8fd4\u56de\u7684\u503c\uff0c\u5e76dispatch\u4e00\u4e2aaction\uff0c\u8fd9\u4e2aaction\u7684payload\u5c31\u662fresolve\u6216reject\u5185\u7684\u503c\uff0c\u7c7b\u578b\u4e3a",(0,s.kt)("inlineCode",{parentName:"p"},"'posts/fetchPosts/fulfilled'"),"\u3002"),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"fetchPosts-payload",src:n(7641).Z,width:"863",height:"467"})),(0,s.kt)("p",null,"\u4e0b\u9762\u5c06\u7ed9\u51fa\u5177\u4f53\u4f7f\u7528\u4f8b\u5b50\u3002"),(0,s.kt)("p",null,"store\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"import { configureStore } from '@reduxjs/toolkit'\nimport postsReducer from './reducers/postsSlice'\nimport { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux'\n\n// \u914d\u7f6estore\nconst store = configureStore({\n  reducer: {\n    postStore: postsReducer,\n  },\n})\n\nexport type AppDispatch = typeof store.dispatch\nexport type RootState = ReturnType<typeof store.getState>\n\nexport const useAppDispatch = () => useDispatch<AppDispatch>()\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector\n\nexport default store\n")),(0,s.kt)("p",null,"::: danger\n\u4e3a\u4e86\u8ba9\u5f02\u6b65\u548cTS\u6574\u5408\uff0c\u91cd\u65b0\u5b9a\u4e49\u4e86",(0,s.kt)("inlineCode",{parentName:"p"},"useAppDispatch"),"\u548c",(0,s.kt)("inlineCode",{parentName:"p"},"useAppSelector"),"\u94a9\u5b50\uff0c\u5426\u5219\u5728\u4f7f\u7528\u5f02\u6b65\u51fd\u6570\u65f6\u4f1a\u62a5TS\u76f8\u5173\u9519\u8bef\uff1a",(0,s.kt)("inlineCode",{parentName:"p"},"Argument of type 'AsyncThunkAction<IPost[], void, AsyncThunkConfig>' is not assignable to parameter of type 'AnyAction'"),"\u3002\n:::"),(0,s.kt)("p",null,"\u5b9a\u4e49reducer\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"import { createAsyncThunk, createSlice } from \"@reduxjs/toolkit\"\nimport type { RootState } from \"../index\"\n\ninterface IPost {\n  id: string\n  title: string\n  content: string\n}\ninterface IState {\n  posts: Array<IPost>\n  status: 'idle' | 'loading' | 'succeeded' | 'failed'\n  error: any\n}\n\nconst initialState: IState = {\n  posts: [\n    { id: '1', title: 'First Post!', content: '\u4f60\u597d!'},\n    { id: '2', title: 'Second Post!', content: 'Hello World!'},\n  ],\n  status: 'idle',\n  error: null,\n}\n\nconst postsSlice = createSlice({\n  name: 'posts',\n  initialState,\n  reducers: {\n    postAdded(state, action) {\n      state.posts.push(action.payload)\n    }\n  },\n  // \u4f7f\u7528extraReducers\u5b57\u6bb5\u5728createSlice\u4e2d\u76d1\u542c\u5f02\u6b65\u51fd\u6570\u72b6\u6001\uff0c\u8fdb\u800c\u505a\u51fa\u76f8\u5173\u4fee\u6539\n  extraReducers(builder) {\n    builder.addCase(addPostAsync.pending, (state, action) => {\n      state.status = 'loading'\n    }).addCase(addPostAsync.fulfilled, (state, action) => {\n      state.status = 'succeeded'\n      state.posts = state.posts.concat(action.payload)\n    }).addCase(addPostAsync.rejected, (state, action) => {\n      state.status = 'failed'\n      state.error = action.error.message\n    }).addCase(addPostAsyncOuter.fulfilled, (state, action) => {\n      state.status = 'succeeded'\n      state.posts = state.posts.concat(action.payload)\n    })\n  }\n})\n// posts\u4e0b\u7684\u5f02\u6b65\u51fd\u6570\nexport const addPostAsync = createAsyncThunk(\n  'posts/addPostAsync',\n  (post: IPost): Promise<Array<IPost>> => {\n    return new Promise((resolve, reject) => {\n      try {\n        setTimeout(() => {\n          resolve([\n            { id: '101', title: '1 Post!', content: 'resolve thunk 101'},\n            { id: '102', title: '2 Post!', content: 'resolve thunk 102'},\n          ])\n        }, 1000)\n      } catch (error) {\n        reject([\n          { id: '103', title: '3 Post!', content: 'reject thunk 10\uff13'},\n        ])\n      }\n    })\n  }\n)\n// \u7528\u6237\u81ea\u5b9a\u4e49\u5f02\u6b65\u51fd\u6570\nexport const addPostAsyncOuter = createAsyncThunk(\n  'outer/addPostAsyncOuter',\n  (post: IPost): Promise<Array<IPost>> => {\n    return new Promise((resolve, reject) => {\n      try {\n        setTimeout(() => {\n          resolve([\n            { id: '104', title: '4 Post! --- outer', content: 'resolve thunk 104'},\n            { id: '105', title: '5 Post! --- outer', content: 'resolve thunk 105'},\n          ])\n        }, 1000)\n      } catch (error) {\n        reject([\n          { id: '106', title: '6 Post! --- outer', content: 'resolve thunk 106'},\n        ])\n      }\n    })\n  }\n)\n// \u901a\u8fc7selector\u9009\u62e9\u5668\u4eceredux\u4e2d\u8bfb\u53d6\u6570\u636e\u903b\u8f91\nexport const selectAllPosts = (state: RootState) => state.postStore.posts\nexport const selectPostStatus = (state: RootState) => state.postStore.status\n\nexport const { postAdded } = postsSlice.actions\n\nexport default postsSlice.reducer\n")),(0,s.kt)("p",null,"::: warning\n\u6ce8\u610f\uff1a",(0,s.kt)("inlineCode",{parentName:"p"},"createAsyncThunk"),"\u521b\u5efa\u7684\u5f02\u6b65\u51fd\u6570\uff0c\u4f20\u5165\u503c\u662fUI\u5c42\u7ec4\u4ef6\u8c03\u7528\u7684useSelector\u94a9\u5b50\u4f20\u5165\u7684\u53c2\u6570\uff0c\u8fd4\u56dePromise resolve\u662f\u5f02\u6b65\u5904\u7406\u7ed3\u679c\uff0c\u8fd9\u4e2a\u5f02\u6b65\u5904\u7406\u7ed3\u679c\u5982\u679c\u9700\u8981\u548c\u5b9a\u4e49\u7684redux store\u6570\u636e\u4ea4\u4e92\uff0c\u9700\u8981\u901a\u8fc7",(0,s.kt)("inlineCode",{parentName:"p"},"extraReducers"),"\u76f8\u5173\u914d\u7f6e\u3002"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"createAsyncThunk"),"\u4e2d\u5176\u5b9e\u662f\u6709\u9519\u8bef\u5904\u7406\u903b\u8f91\u7684\uff0c\u56e0\u6b64Promise reject\u5199\u4e86\u662f\u6ca1\u6709\u7528\u7684\uff0c\u8fd9\u5757\u903b\u8f91\u7528async/await\u5199\u66f4\u7b80\u6d01\u3002\n:::"),(0,s.kt)("p",null,"\u9876\u90e8App\u7ec4\u4ef6\u63d0\u4f9bstore\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-tsx"},'import store from "./store";\nimport { Provider } from \'react-redux\'\nimport "./App.css"\nimport PostsForm from "./views/PostsForm";\n// \u5728\u9876\u90e8\u901a\u8fc7Provider\u63d0\u4f9b\u6574\u4e2astore\nexport default function App() {\n  return <Provider store={store}>\n    <PostsForm />\n  </Provider>\n}\n')),(0,s.kt)("p",null,"\u7ec4\u4ef6UI\u5c42\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-tsx"},'import { nanoid } from "@reduxjs/toolkit";\nimport { ChangeEvent, useState } from "react";\nimport { addPostAsync, addPostAsyncOuter, postAdded, selectPostStatus } from "../store/reducers/postsSlice";\nimport { useAppDispatch, useAppSelector } from \'../store/index\'\nconst initFormData = {\n  title: \'\',\n  content: \'\',\n}\nconst AddPostForm = () => {\n  const [formData, setFormData] = useState(initFormData)\n  const dispatch = useAppDispatch()\n  const postStatus = useAppSelector(selectPostStatus)\n  const onSavePostClicked = () => {\n    if(formData.title && formData.content) {\n      // \u8fd9\u4e2adispatch\u7684\u8fd4\u56de\u503c\u53ef\u4ee5\u7528unwarp()\u51fd\u6570\u67e5\u770b\u76f8\u5173\u903b\u8f91\n      dispatch(addPostAsyncOuter({\n        id: nanoid(),\n        title: formData.title,\n        content: formData.content,\n      }))\n      setFormData(initFormData)\n    }\n  }\n  return (\n    <div>\n      <p className="text-2xl font-bold text-cyan-600">Add a new post</p>\n      <form>\n        <label htmlFor="postTitle">Post Title\uff1a</label>\n        <input\n          className="border-2 border-black"\n          type="text"\n          id="postTitle"\n          name="postTitle"\n          value={formData.title}\n          onChange={(e: ChangeEvent<HTMLInputElement>) => setFormData({ ...formData, title: e.target.value})}\n        />\n        <label htmlFor="postContent">Content\uff1a</label>\n        <input\n          className="border-2 border-black"\n          type="text"\n          id="postContent"\n          name="postContent"\n          value={formData.content}\n          onChange={(e: ChangeEvent<HTMLInputElement>) => setFormData({ ...formData, content: e.target.value})}\n        />\n        <button className="block m-2 p-2 text-white bg-blue-500 hover:bg-blue-600" type="button" onClick={onSavePostClicked}>\n        { postStatus } --- Save Post\n        </button>\n      </form>\n    </div>\n  )\n}\nexport default AddPostForm;\n')),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-tsx"},'import { selectAllPosts } from "../store/reducers/postsSlice";\nimport { useAppSelector } from \'../store/index\'\n\nconst PostsList = () => {\n  const posts = useAppSelector(selectAllPosts)\n  return (\n    <section>\n      <p className="text-2xl font-bold">Posts</p>\n      { posts.map(post => (\n        <article key={post.id} className="border-2 border-black rounded-md my-2">\n          <p className="text-red-500 text-xl">{post.title}</p>\n          <p>{post.content}</p>\n        </article>\n      ))}\n    </section>\n  )\n}\nexport default PostsList;\n')),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-tsx"},'import AddPostForm from "../components/AddPostForm";\nimport PostsList from "../components/PostsList";\n\nconst PostsForm = () => {\n  return (\n    <>\n      <AddPostForm />\n      <PostsList />\n    </>\n  )\n}\nexport default PostsForm;\n')),(0,s.kt)("h2",{id:"\u6027\u80fd\u4e0e\u8303\u5f0f\u4f18\u5316"},"\u6027\u80fd\u4e0e\u8303\u5f0f\u4f18\u5316"),(0,s.kt)("h3",{id:"\u8bb0\u5fc6\u5316selector\u51fd\u6570"},"\u8bb0\u5fc6\u5316selector\u51fd\u6570"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"Reselect"),"\u662f\u4e00\u4e2a\u521b\u5efa\u8bb0\u5fc6\u5316selector\u51fd\u6570\u7684\u5e93\uff0c\u5e76\u4e14\u662f\u4e13\u95e8\u8bbe\u8ba1\u7528\u6765\u4e0eRedux\u4e00\u8d77\u4f7f\u7528\u7684\u3002\u5b83\u6709\u4e00\u4e2a",(0,s.kt)("inlineCode",{parentName:"p"},"createSelector"),"\u51fd\u6570\uff0c\u53ef\u4ee5\u521b\u5efa\u8bb0\u5fc6\u5316\u7684 selector\uff0c\u53ea\u6709\u5728\u8f93\u5165\u53d1\u751f\u53d8\u5316\u65f6\u624d\u4f1a\u91cd\u65b0\u8ba1\u7b97\u7ed3\u679c\u3002Redux Toolkit\u5bfc\u51fa\u4e86",(0,s.kt)("inlineCode",{parentName:"p"},"createSelector"),"\u51fd\u6570\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u5b83\u3002"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"createSelector"),"\u51fd\u6570\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"\u53c2\u65701\uff1a\u6570\u7ec4\u7c7b\u578b\uff0c\u6bcf\u4e2a\u5143\u7d20\u662f\u4e2aselector"),(0,s.kt)("li",{parentName:"ul"},"\u53c2\u65702\uff1a\u51fd\u6570\u7c7b\u578b\uff0c\u4f20\u5165\u53c2\u6570\u4f9d\u6b21\u4e3a\u53c2\u65701\u4e2d\u5404\u4e2aselector\u7684\u8fd4\u56de\u503c\uff0c\u6267\u884c\u8f93\u51faselector")),(0,s.kt)("p",null,"\u5982\u679c\u6211\u4eec\u5c1d\u8bd5\u591a\u6b21\u8c03\u7528 selectPostsByUser\uff0c\u5b83",(0,s.kt)("strong",{parentName:"p"},"\u53ea\u4f1a\u5728posts\u6216userId\u53d1\u751f\u53d8\u5316\u65f6\u91cd\u65b0\u6267\u884c\u8f93\u51faselector"),"\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"export const selectPostsByUser = createSelector(\n  [selectAllPosts, (state, userId) => userId],\n  (posts, userId) => posts.filter(post => post.id === userId)\n)\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-tsx{3,15-17}"},'const PostsList = () => {\n  const posts = useAppSelector(selectAllPosts)\n  const postsForUser = useAppSelector(state => selectPostsByUser(state, \'102\'))\n  return (\n    <section>\n      <p className="text-2xl font-bold">Posts</p>\n      { posts.map(post => (\n        <article key={post.id} className="border-2 border-black rounded-md my-2">\n          <p className="text-red-500 text-xl">{post.title}</p>\n          <p>{post.content}</p>\n        </article>\n      ))}\n      <div>\n        <p>\u9009\u4e2d\u7684\u503c\uff1a</p>\n        { postsForUser.map(post => (\n          <p key={post.id}>{post.title} - {post.content}</p>\n        ))}\n      </div>\n    </section>\n  )\n}\n')),(0,s.kt)("h3",{id:"\u8303\u5f0f\u5316\u6570\u636e"},"\u8303\u5f0f\u5316\u6570\u636e"),(0,s.kt)("p",null,"\u8303\u5f0f\u5316state\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"\u6211\u4eecstate\u4e2d\u7684\u6bcf\u4e2a\u7279\u5b9a\u6570\u636e\u53ea\u6709\u4e00\u4e2a\u526f\u672c\uff0c\u4e0d\u5b58\u5728\u91cd\u590d\u3002"),(0,s.kt)("li",{parentName:"ul"},"\u5df2\u8303\u5f0f\u5316\u7684\u6570\u636e\u4fdd\u5b58\u5728\u67e5\u627e\u8868\u4e2d\uff0c\u5176\u4e2d\u9879\u76eeID\u662f\u952e\uff0c\u9879\u672c\u8eab\u662f\u503c\u3002"),(0,s.kt)("li",{parentName:"ul"},"\u4e5f\u53ef\u80fd\u6709\u4e00\u4e2a\u7279\u5b9a\u9879\u7528\u4e8e\u4fdd\u5b58\u6240\u6709ID\u7684\u6570\u7ec4\u3002")),(0,s.kt)("p",null,"\u4ee5\u4e0b\u662f\u4e00\u7ec4\u201c\u7528\u6237\u201d\u5bf9\u8c61\u7684\u8303\u5f0f\u5316state\u53ef\u80fd\u5982\u4e0b\u6240\u793a\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},'{\n  users: {\n    ids: ["user1", "user2", "user3"],\n    entities: {\n      "user1": {id: "user1", firstName, lastName},\n      "user2": {id: "user2", firstName, lastName},\n      "user3": {id: "user3", firstName, lastName},\n    }\n  }\n}\n')),(0,s.kt)("p",null,"\u8fd9\u4f7f\u5f97\u901a\u8fc7ID\u67e5\u627e\u7279\u5b9a\u7684\u201c\u7528\u6237\u201d\u5bf9\u8c61\u53d8\u5f97\u7b80\u5355\uff0c\u4e0d\u9700\u904d\u5386\u6570\u7ec4\u4e2d\u5176\u4ed6\u7684\u7528\u6237\u5bf9\u8c61\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-js"},"const userId = 'user2'\nconst userObject = state.users.entities[userId]\n")),(0,s.kt)("p",null,"Redux Toolkit\u7684",(0,s.kt)("inlineCode",{parentName:"p"},"createEntityAdapter"),"API\u63d0\u4f9b\u4e86\u4e00\u79cd\u5c06\u6570\u636e\u5b58\u50a8\u5728slice\u4e2d\u7684\u6807\u51c6\u5316\u65b9\u6cd5\uff0c\u5373\u83b7\u53d6\u9879\u76ee\u96c6\u5408\u5e76\u653e\u5165\u5230",(0,s.kt)("inlineCode",{parentName:"p"},"{ ids: [], entities: {} }"),"\u7684\u7ed3\u6784\u4e2d\uff0c\u9664\u4e86\u8fd9\u4e2a\u9884\u5b9a\u4e49\u7684\u7ed3\u6784\uff0c\u8fd8\u4f1a\u751f\u6210\u4e00\u7ec4\u5982\u4f55\u5904\u7406\u6539\u6570\u636e\u7684reducer\u51fd\u6570\u548cselector\u3002"),(0,s.kt)("p",null,"\u4f18\u70b9\uff1a"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"\u4e0d\u7528\u7ec4\u4ef6\u7f16\u5199\u4ee3\u7801\u7ba1\u7406\u8303\u5f0f\u5316\u3002"),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("inlineCode",{parentName:"li"},"createEntityAdapter"),"\u7684\u9884\u6784\u5efareducer\u51fd\u6570\u80fd\u5904\u7406\u4e00\u4e9b\u5e38\u89c1\u60c5\u51b5\uff0c\u5982\u589e\u5220\u6539\u3002"),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("inlineCode",{parentName:"li"},"createEntityAdapter"),"\u53ef\u4ee5\u57fa\u4e8e\u9879\u7684\u5185\u5bb9\u5c06ID\u4fdd\u6301\u5728\u6392\u5e8f\u6570\u7ec4\u4e2d\uff0c\u5e76\u4ec5\u5728\u6dfb\u52a0/\u5220\u9664\u9879\u6216\u6392\u5e8f\u89c4\u5219\u66f4\u6539\u65f6\u624d\u4f1a\u66f4\u65b0\u8be5\u6570\u7ec4\u3002")),(0,s.kt)("p",null,"Redux Toolkit\u7684",(0,s.kt)("inlineCode",{parentName:"p"},"createEntityAdapter"),"API\u5e2e\u52a9\u7ba1\u7406slice\u4e2d\u7684\u8303\u5f0f\u5316\u6570\u636e"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u4f20\u5165",(0,s.kt)("inlineCode",{parentName:"li"},"sortComparer"),"\u9009\u9879\uff0c\u53ef\u4ee5\u6309\u6392\u5e8f\u987a\u5e8f\u4fdd\u6301\u9879\u76eeID"),(0,s.kt)("li",{parentName:"ul"},"adapter\u5bf9\u8c61\u5305\u62ec\uff1a",(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"adapter.getInitialState"),"\uff0c\u5b83\u53ef\u4ee5\u63a5\u53d7\u989d\u5916\u7684state\u5b57\u6bb5\uff0c\u5982\u52a0\u8f7dstate"),(0,s.kt)("li",{parentName:"ul"},"\u9884\u5148\u521b\u5efa\u901a\u7528 reducer\uff0c\u4f8b\u5982setAll\u3001addMany\u3001upsertOne\u548cremoveMany"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"adapter.getSelectors"),"\uff0c\u751f\u6210\u7c7b\u4f3c\u4e8eselectAll\u548cselectById\u7684selector")))),(0,s.kt)("p",null,"\u4f7f\u7528",(0,s.kt)("inlineCode",{parentName:"p"},"createEntityAdapter"),"\u540e\uff0cslice\u5199\u6210\u5982\u4e0b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"import {\n  createAsyncThunk,\n  createSlice,\n  createSelector,\n  createEntityAdapter\n} from \"@reduxjs/toolkit\"\nimport type { RootState } from \"../index\"\n\ninterface IPost {\n  id: string\n  title: string\n  content: string\n}\ninterface IMSG {\n  status: 'idle' | 'loading' | 'succeeded' | 'failed'\n  error: any\n}\n\nconst postsAdapter = createEntityAdapter<IPost>()\n\nconst initialState = postsAdapter.getInitialState<IMSG>({\n  status: 'idle',\n  error: null\n})\n\nconst postsSlice = createSlice({\n  name: 'posts',\n  initialState,\n  reducers: {\n    postAdded(state, action) {\n      postsAdapter.upsertOne(state, action.payload)\n    }\n  },\n  extraReducers(builder) {\n    builder.addCase(addPostAsync.pending, (state, action) => {\n      state.status = 'loading'\n    }).addCase(addPostAsync.fulfilled, (state, action) => {\n      state.status = 'succeeded'\n      postsAdapter.upsertOne(state, action.payload)\n    }).addCase(addPostAsync.rejected, (state, action) => {\n      state.status = 'failed'\n      state.error = action.error.message\n    }).addCase(addPostAsyncOuter.fulfilled, (state, action) => {\n      state.status = 'succeeded'\n      postsAdapter.upsertOne(state, action.payload)\n    })\n  }\n})\n\nexport const addPostAsync = createAsyncThunk(\n  'posts/addPostAsync',\n  (post: IPost): Promise<IPost> => {\n    return new Promise((resolve, reject) => {\n      setTimeout(() => {\n        resolve(post)\n      }, 1000)\n    })\n  }\n)\n\nexport const addPostAsyncOuter = createAsyncThunk(\n  'outer/addPostAsyncOuter',\n  (post: IPost): Promise<IPost> => {\n    return new Promise((resolve, reject) => {\n      setTimeout(() => {\n        resolve({\n          id: post.id,\n          title: `${post.title}-outer`,\n          content: `${post.content}-outer`,\n        })\n      }, 1000)\n    })\n  }\n)\n\nexport const {\n  selectAll: selectAllPosts,\n  selectById: selectPostById,\n  selectIds: selectPostIds\n} = postsAdapter.getSelectors((state: RootState) => state.postStore)\n\nexport const selectPostStatus = (state: RootState) => state.postStore.status\nexport const selectPostsByUser = createSelector(\n  [selectAllPosts, (state, userId) => userId],\n  (posts, userId) => posts.filter(post => post.id === userId)\n)\n\nexport const { postAdded } = postsSlice.actions\n\nexport default postsSlice.reducer\n")),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"createEntityAdapter",src:n(5327).Z,width:"1123",height:"204"})),(0,s.kt)("h2",{id:"rtk-query"},"RTK Query"),(0,s.kt)("p",null,"RTK Query\uff1a\u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u6570\u636e\u83b7\u53d6\u548c\u7f13\u5b58\u5de5\u5177\u3002\u5b83\u65e8\u5728",(0,s.kt)("strong",{parentName:"p"},"\u7b80\u5316\u5728Web\u5e94\u7528\u7a0b\u5e8f\u4e2d\u52a0\u8f7d\u6570\u636e\u7684\u5e38\u89c1\u60c5\u51b5\uff0c\u65e0\u9700\u81ea\u5df1\u624b\u52a8\u7f16\u5199\u6570\u636e\u83b7\u53d6\u548c\u7f13\u5b58\u903b\u8f91"),"\u3002RTK Query\u662f\u4e00\u4e2a\u5305\u542b\u5728Redux Toolkit\u5305\u4e2d\u7684\u53ef\u9009\u63d2\u4ef6\uff0c\u5176\u529f\u80fd\u6784\u5efa\u5728Redux Toolkit\u4e2d\u7684\u5176\u4ed6API\u4e4b\u4e0a\u3002"),(0,s.kt)("p",null,"RTK Query \u4e3b\u8981\u7531\u4e24\u4e2a API \u7ec4\u6210\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"createApi()"),"\uff1aRTK Query \u529f\u80fd\u7684\u6838\u5fc3\u3002\u5b83\u5141\u8bb8\u4f60\u5b9a\u4e49\u4e00\u7ec4\u8bf7\u6c42\u63a5\u53e3\u6765\u63cf\u8ff0\u5982\u4f55\u4ece\u4e00\u7cfb\u5217\u8bf7\u6c42\u63a5\u53e3\u68c0\u7d22\u6570\u636e\uff0c\u5305\u62ec\u5982\u4f55\u83b7\u53d6\u548c\u8f6c\u6362\u8be5\u6570\u636e\u7684\u914d\u7f6e\u3002\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u4f60\u5e94\u8be5\u5728\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u4e00\u6b21\uff0c\u6839\u636e\u7ecf\u9a8c\uff0c\u201c\u6bcf\u4e2a\u57fa\u672cURL\u4e00\u4e2aAPI slice\u201d\u3002"),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"fetchBaseQuery()"),": fetch \u7684\u4e00\u4e2a\u5c0f\u5305\u88c5\uff0c\u65e8\u5728\u7b80\u5316\u8bf7\u6c42\u3002\u65e8\u5728\u4e3a\u5927\u591a\u6570\u7528\u6237\u5728",(0,s.kt)("inlineCode",{parentName:"li"},"createApi"),"\u4e2d\u4f7f\u7528\u63a8\u8350\u7684",(0,s.kt)("inlineCode",{parentName:"li"},"baseQuery"),"\u3002")),(0,s.kt)("p",null,"Redux Toolkit\u6838\u5fc3API\u4e0d\u4f1a\u66f4\u6539Redux\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u4efb\u4f55\u57fa\u672c\u6570\u636e\u6d41\uff0c\u4f60\u4ecd\u5728\u8c03\u5ea6\u64cd\u4f5c\u548c\u7f16\u5199reducer\uff0c\u53ea\u662f\u4ee3\u7801\u6bd4\u624b\u52a8\u7f16\u5199\u6240\u6709\u903b\u8f91\u8981\u5c11\u3002RTK Query\u540c\u7406\uff0c\u8fd9\u662f\u4e00\u4e2a\u989d\u5916\u7684\u62bd\u8c61\u7ea7\u522b\uff0c\u4f46\u5728\u5185\u90e8\uff0c\u5b83\u4ecd\u5728\u6267\u884c\u6211\u4eec\u5df2\u7ecf\u770b\u5230\u7684\u7528\u4e8e\u7ba1\u7406\u5f02\u6b65\u8bf7\u6c42\u53ca\u5176\u54cd\u5e94\u7684\u5b8c\u5168\u76f8\u540c\u7684\u6b65\u9aa4\u3002"),(0,s.kt)("p",null,"\u4f46\u662f\uff0c\u5f53\u4f60\u4f7f\u7528RTK Query\u65f6\uff0c\u4f1a\u53d1\u751f\u601d\u7ef4\u8f6c\u53d8\u3002\u6211\u4eec\u4e0d\u518d\u8003\u8651\u201c\u7ba1\u7406\u72b6\u6001\u201d\u672c\u8eab\u3002\u76f8\u53cd\uff0c\u6211\u4eec\u73b0\u5728",(0,s.kt)("strong",{parentName:"p"},"\u8003\u8651\u201c\u7ba1\u7406\u7f13\u5b58\u6570\u636e\u201d"),"\u3002\u4e0e\u5176\u5c1d\u8bd5\u81ea\u5df1\u7f16\u5199reducer\uff0c\u6211\u4eec\u73b0\u5728\u5c06\u4e13\u6ce8\u4e8e\u5b9a\u4e49\u201c\u8fd9\u4e9b\u6570\u636e\u6765\u81ea\u54ea\u91cc\uff1f\u201d\u3001\u201c\u8fd9\u4e2a\u66f4\u65b0\u5e94\u8be5\u5982\u4f55\u53d1\u9001\uff1f\u201d\u3001\u201c\u8fd9\u4e2a\u7f13\u5b58\u7684\u6570\u636e\u5e94\u8be5\u4ec0\u4e48\u65f6\u5019\u91cd\u65b0\u83b7\u53d6\uff1f\u201d\uff0c\u4ee5\u53ca\u201c\u7f13\u5b58\u7684\u6570\u636e\u5e94\u8be5\u5982\u4f55\u66f4\u65b0\uff1f\u201d\u3002\u5982\u4f55\u83b7\u53d6\u3001\u5b58\u50a8\u548c\u68c0\u7d22\u8fd9\u4e9b\u6570\u636e\u6210\u4e3a\u6211\u4eec\u4e0d\u518d\u9700\u8981\u62c5\u5fc3\u7684\u5b9e\u73b0\u7ec6\u8282\u3002"),(0,s.kt)("p",null,"\u5b9a\u4e49apiSlice\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts"},"import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'\n\ninterface IPost {\n  id: string\n  title: string\n  content: string\n}\n\nexport const apiSlice = createApi({\n  // \u5b9a\u4e49\u9876\u7ea7\u72b6\u6001slice\u5b57\u6bb5\n  reducerPath: 'api',\n  // \u6211\u4eec\u6240\u6709\u7684\u8bf7\u6c42\u90fd\u6709\u4ee5/fakeApi\u5f00\u5934\u7684URL\n  baseQuery: fetchBaseQuery({ baseUrl: '/fakeApi' }),\n  tagTypes: ['Posts'],\n  // endpoints\u4ee3\u8868\u5bf9\u8be5\u670d\u52a1\u5668\u7684\u64cd\u4f5c\u548c\u8bf7\u6c42\n  endpoints: builder => ({\n    // getPosts\u662f\u4e00\u4e2a\u8fd4\u56de\u6570\u636e\u7684Query\u64cd\u4f5c\n    getPosts: builder.query<any, void>({\n      // \u8bf7\u6c42\u7684URL\u662f/fakeApi/posts\n      query: () => '/posts',\n    }),\n    // updatePosts\u662f\u4e2a\u7a81\u53d8\u64cd\u4f5c\uff0c\u5373\u66f4\u65b0\u670d\u52a1\u5668\u4e0a\u6570\u636e\u7684\u64cd\u4f5c\n    updatePosts: builder.mutation<any, IPost>({\n      query: (body) => {\n        const { id, title, content} = body\n        return {\n          url: `/updatePosts/${id}`,\n          method: 'POST',\n          body: {\n            title,\n            content,\n          }\n        }\n      },\n      // \u66f4\u65b0\u4f1a\u4f7f\u63d0\u4f9b\u4e86\u8fd9\u4e9b\u6807\u7b7e\u7684\u67e5\u8be2\u5931\u6548\n      invalidatesTags: (result, error, arg) => [\n        { type: 'Posts', id: arg.id }\n      ]\n    })\n  })\n})\n\n// \u4e3aQuery endpoint\u5bfc\u51fa\u81ea\u52a8\u751f\u6210\u7684hooks\nexport const { useGetPostsQuery, useUpdatePostsMutation } = apiSlice\n")),(0,s.kt)("p",null,"\u5728store\u4e2d\u6ce8\u518c\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts{4,10,12,13}"},"import { configureStore } from '@reduxjs/toolkit'\nimport { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux'\nimport postsReducer from './reducers/postsSlice'\nimport { apiSlice } from './reducers/apiSlice'\n\n// \u914d\u7f6estore\nconst store = configureStore({\n  reducer: {\n    postStore: postsReducer,\n    [apiSlice.reducerPath]: apiSlice.reducer,\n  },\n  // \u8fd9\u4e2amiddleware\u5fc5\u987b\u6dfb\u52a0\uff0c\u5b83\u7ba1\u7406\u7f13\u5b58\u7684\u751f\u547d\u5468\u671f\u548c\u63a7\u5236\u662f\u5426\u8fc7\u671f\n  middleware: getDefaultMiddleware => getDefaultMiddleware().concat(apiSlice.middleware),\n})\n\nexport type AppDispatch = typeof store.dispatch\nexport type RootState = ReturnType<typeof store.getState>\n\nexport const useAppDispatch = () => useDispatch<AppDispatch>()\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector\n\nexport default store\n")),(0,s.kt)("p",null,"\u5728UI\u7ec4\u4ef6\u5c42\u4f7f\u7528\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-tsx"},"import { useGetPostsQuery, useUpdatePostsMutation } from '../store/reducers/apiSlice'\nconst PostsList = () => {\n  // refetch\u662f\u8bf7\u6c42\u64cd\u4f5c\u51fd\u6570\n  const { data, isLoading: isGetPostsLoading, refetch: getPostsAPI } = useGetPostsQuery()\n  // \u6570\u7ec4\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\u64cd\u4f5c\u51fd\u6570\n  const [updatePostsAPI, { isLoading: isUpdatePostsLoading }] = useUpdatePostsMutation()\n\n  const updatePosts = () => {\n    updatePostsAPI({ id: '1234', title: 'Alice', content: '\u4f60\u597d\u4e16\u754c' }).then(r => {\n      console.log(r)\n    })\n  }\n  if (isGetPostsLoading) {\n    return <div>\u52a0\u8f7d\u4e2d...</div>\n  }\n  return (\n    <section>\n      <p>\n        <button onClick={getPostsAPI}>getPostsAPI\u64cd\u4f5c</button>\n        <button onClick={updatePosts}>updatePosts\u64cd\u4f5c</button>\n      </p>\n    </section>\n  )\n}\nexport default PostsList;\n")))}d.isMDXComponent=!0},1501:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/ReduxAsyncDataFlowDiagram-d97ff38a0f4da0f327163170ccc13e80.gif"},7120:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/ReduxDataFlowDiagram-49fa8c3968371d9ef6f2a1486bd40a26.gif"},5327:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/createEntityAdapter-4c7b5564fef2ba36052c519f2080c38a.png"},7641:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/fetchPosts-payload-c24e827607b0e7a5ee0b913dce2fdc04.png"},1805:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/redux\u8ba1\u6570\u5668-1da72b0a2cbd3fbd14c192e9d239d041.gif"}}]);